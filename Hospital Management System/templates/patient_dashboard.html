{% extends 'base.html' %}
{% block content %}
<h3 class="mb-4">Patient Dashboard <small class="text-muted">| Patient ID: {{ current_user.patient_id or current_user._id }}</small></h3>
<div class="row g-3">
  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="text-muted">Recent Appointments</h6>
        {% if appointments %}
          <ul class="list-group list-group-flush">
            {% for appointment in appointments %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <strong>{{ appointment.doctor_name }}</strong><br>
                  <small class="text-muted">{{ appointment.preferred_date }} {{ appointment.preferred_time }}</small>
                </div>
                <span class="badge bg-{% if appointment.status == 'CONFIRMED' %}success{% elif appointment.status == 'REQUESTED' %}warning{% else %}secondary{% endif %}">
                  {{ appointment.status }}
                </span>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">No recent appointments</p>
        {% endif %}
        <div class="mt-3">
          <a href="{{ url_for('patient_appointments') }}" class="btn btn-primary btn-sm">Book New Appointment</a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="text-muted">Recent Receipts</h6>
        {% if invoices %}
          <ul class="list-group list-group-flush">
            {% for invoice in invoices %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <strong>Invoice #{{ invoice._id }}</strong><br>
                  <small class="text-muted">{{ invoice.date.strftime('%Y-%m-%d') }}</small>
                </div>
                <div class="text-end">
                  <div class="fw-bold">${{ "%.2f"|format(invoice.total) }}</div>
                  <span class="badge bg-{% if invoice.status == 'PAID' %}success{% else %}warning{% endif %}">
                    {{ invoice.status }}
                  </span>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">No recent receipts</p>
        {% endif %}
        <div class="mt-3">
          <a href="{{ url_for('patient_receipts') }}" class="btn btn-outline-primary btn-sm">View All Receipts</a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="mb-3">Quick Actions</h6>
        <div class="row g-2">
          <div class="col-md-3">
            <a href="{{ url_for('patient_appointments') }}" class="btn btn-outline-primary w-100">
              <i class="bi bi-calendar-plus"></i><br>
              Book Appointment
            </a>
          </div>
          <div class="col-md-3">
            <a href="{{ url_for('patient_appointment_history') }}" class="btn btn-outline-info w-100">
              <i class="bi bi-clock-history"></i><br>
              Appointment History
            </a>
          </div>
          <div class="col-md-3">
            <a href="{{ url_for('patient_medical_history') }}" class="btn btn-outline-success w-100">
              <i class="bi bi-file-medical"></i><br>
              Medical History
            </a>
          </div>
          <div class="col-md-3">
            <a href="{{ url_for('patient_personal_details') }}" class="btn btn-outline-secondary w-100">
              <i class="bi bi-person-gear"></i><br>
              Personal Details
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Complaints Section -->
  <div class="col-12">
    <div class="card shadow-sm mt-3">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h6 class="mb-0">Complaints</h6>
        </div>
        <div class="row g-3">
          <div class="col-md-6">
            <form method="post" action="{{ url_for('patient_complaint_new') }}">
              <div class="mb-2">
                <label class="form-label">Subject</label>
                <input type="text" name="subject" class="form-control" required>
              </div>
              <div class="mb-2">
                <label class="form-label">Priority</label>
                <select name="priority" class="form-select">
                  <option value="LOW">Low</option>
                  <option value="MEDIUM" selected>Medium</option>
                  <option value="HIGH">High</option>
                </select>
              </div>
              <div class="mb-2">
                <label class="form-label">Description</label>
                <textarea name="description" class="form-control" rows="3" required></textarea>
              </div>
              <button type="submit" class="btn btn-primary">Submit Complaint</button>
            </form>
          </div>
          <div class="col-md-6">
            <h6 class="text-muted">Recent Complaints</h6>
            {% if complaints %}
            <ul class="list-group list-group-flush">
              {% for c in complaints %}
              <li class="list-group-item d-flex justify-content-between align-items-start">
                <div class="me-2">
                  <strong>{{ c.subject }}</strong><br>
                  <small class="text-muted">{{ c.created_at.strftime('%Y-%m-%d') }}</small>
                  <div class="small mt-1">{{ c.description[:80] }}{% if c.description|length > 80 %}...{% endif %}</div>
                </div>
                <span class="badge bg-{% if c.status == 'RESOLVED' %}success{% elif c.status == 'IN_PROGRESS' %}warning{% else %}secondary{% endif %}">{{ c.status }}</span>
              </li>
              {% endfor %}
            </ul>
            {% else %}
              <p class="text-muted">No complaints yet.</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
